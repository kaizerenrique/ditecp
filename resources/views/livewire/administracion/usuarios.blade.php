<div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 p-4 gap-4">
        <div class="bg-blue-500 dark:bg-gray-800 shadow-lg rounded-md flex items-center justify-between p-3 border-b-4 border-blue-600 dark:border-gray-600 text-white font-medium group">
            <div class="flex justify-center items-center w-14 h-14 bg-white rounded-full transition-all duration-300 transform group-hover:rotate-12">
                <svg width="30" height="30" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="stroke-current text-blue-800 dark:text-gray-800 transform transition-transform duration-500 ease-in-out">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"></path>
                </svg>
            </div>
            <div class="text-right">
                <p class="text-2xl">{{$users_count}}</p>
                <p>Usuarios</p>
            </div>
        </div>
        <div class="bg-blue-500 dark:bg-gray-800 shadow-lg rounded-md flex items-center justify-between p-3 border-b-4 border-blue-600 dark:border-gray-600 text-white font-medium group">
            <div class="flex justify-center items-center w-14 h-14 bg-white rounded-full transition-all duration-300 transform group-hover:rotate-12">
                <svg width="30" height="30" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="stroke-current text-blue-800 dark:text-gray-800 transform transition-transform duration-500 ease-in-out">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                </svg>
            </div>
            <div class="text-right">
                <p class="text-2xl">{{$tokens}}</p>
                <p>Tokens Generados</p>
            </div>
        </div>
        <div class="bg-blue-500 dark:bg-gray-800 shadow-lg rounded-md flex items-center justify-between p-3 border-b-4 border-blue-600 dark:border-gray-600 text-white font-medium group">
            <div class="flex justify-center items-center w-14 h-14 bg-white rounded-full transition-all duration-300 transform group-hover:rotate-12">
                <svg width="30" height="30" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="stroke-current text-blue-800 dark:text-gray-800 transform transition-transform duration-500 ease-in-out">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </div>
            <div class="text-right">
                <p class="text-2xl"></p>
                <p>Total Tokens Disponibles</p>
            </div>
        </div>
        <div class="bg-blue-500 dark:bg-gray-800 shadow-lg rounded-md flex items-center justify-between p-3 border-b-4 border-blue-600 dark:border-gray-600 text-white font-medium group">
            <div class="flex justify-center items-center w-14 h-14 bg-white rounded-full transition-all duration-300 transform group-hover:rotate-12">
                <svg width="30" height="30" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="stroke-current text-blue-800 dark:text-gray-800 transform transition-transform duration-500 ease-in-out">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.25 6L9 12.75l4.286-4.286a11.948 11.948 0 014.306 6.43l.776 2.898m0 0l3.182-5.511m-3.182 5.51l-5.511-3.181" />
                </svg>
            </div>
            <div class="text-right">
                <p class="text-2xl"></p>
                <p>Tokens Restantes</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 p-4 gap-4">
        <!-- ultimas conexiones -->
        <div class="relative flex flex-col min-w-0 mb-4 lg:mb-0 break-words bg-gray-50 dark:bg-gray-800 w-full shadow-lg rounded">
            <div class="rounded-t mb-0 px-0 border-0">
                <div class="flex flex-wrap items-center px-4 py-2">
                    <div class="relative w-full max-w-full flex-grow flex-1">
                      <h3 class="font-semibold text-base text-gray-900 dark:text-gray-50">Actividades Recientes</h3>
                    </div>
                </div>
                <div class="block w-full overflow-x-auto">
                    <table class="items-center w-full bg-transparent border-collapse">
                        <thead>
                            <tr>
                              <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle 
                              border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 
                              border-r-0 whitespace-nowrap font-semibold text-left">Nombre</th>
                              <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle 
                              border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 
                              border-r-0 whitespace-nowrap font-semibold text-left">Actividad</th>
                            </tr>
                          </thead>
                          <tbody>
                            @foreach ($tokensinfo as $tokensli )
                                <tr class="text-gray-700 dark:text-gray-100">
                                    <th class="border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left">
                                        {{$tokensli->name}}
                                    </th>
                                    <td class="border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4">
                                        @if ($tokensli->last_used_at)
                                            {{ \Carbon\Carbon::parse($tokensli->last_used_at)->diffForHumans() }}                                            
                                        @else
                                            <p>No Usado</p>
                                        @endif
                                    </td>
                                </tr>                            
                            @endforeach                        
                          </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- /ultimas conexiones -->
        <!-- ultimos registros -->
        <div class="relative flex flex-col min-w-0 break-words bg-gray-50 dark:bg-gray-800 w-full shadow-lg rounded">
            <div class="rounded-t mb-0 px-0 border-0">
                <div class="flex flex-wrap items-center px-4 py-2">
                    <div class="relative w-full max-w-full flex-grow flex-1">
                    <h3 class="font-semibold text-base text-gray-900 dark:text-gray-50">Ultimas consultas</h3>
                    </div>
                </div>
                <div class="block w-full">
                    <table class="items-center w-full bg-transparent border-collapse">
                        <thead>
                            <tr>
                                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle 
                                border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 
                                border-r-0 whitespace-nowrap font-semibold text-left">Usuario</th>
                                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle 
                                border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 
                                border-r-0 whitespace-nowrap font-semibold text-left">Nombre del Token</th>
                                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle 
                                border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 
                                border-r-0 whitespace-nowrap font-semibold text-left">Funci√≥n</th>
                                <th class="px-4 bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-100 align-middle 
                                border border-solid border-gray-200 dark:border-gray-500 py-3 text-xs uppercase border-l-0 
                                border-r-0 whitespace-nowrap font-semibold text-left">Actividad</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($registros as $registro )
                                <tr class="text-gray-700 dark:text-gray-100">
                                    <th class="border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left">
                                        @foreach ($usuarios as $usuario)
                                            @if ($usuario->id == $registro->user_id)
                                                {{$usuario->name}}
                                            @endif                                            
                                        @endforeach                                   
                                    </th>
                                    <th class="border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left">
                                        @foreach ($tokensinfo as $tokensli)
                                            @if ($tokensli->id == $registro->token_id)
                                                {{$tokensli->name}}
                                            @endif
                                        @endforeach                                                                            
                                    </th>
                                    <th class="border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left">
                                        {{$registro->operacion}}                                                                          
                                    </th> 
                                    <th class="border-t-0 px-4 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left">
                                        {{ \Carbon\Carbon::parse($registro->created_at)->diffForHumans() }}                                                                        
                                    </th>                                   
                                </tr>                            
                            @endforeach                        
                        </tbody>
                    </table>                
                </div>
            </div>
        </div>
        <!-- /ultimos registros -->
    </div>
    
    <div class="mt-4 mx-4">
        <div class="flex flex-wrap items-center px-4 py-2">
            <div class="relative w-full max-w-full flex-grow flex-1">
              <h3 class="font-semibold text-base text-gray-900 dark:text-gray-50">Listado de usuarios Registrados</h3>
            </div>
            <div class="flex flex-col items-center w-full max-w-xl">            
                <input type="search" wire:model="buscar" placeholder="Buscar" class="w-100 mt-2 py-3 px-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-700 text-gray-800 dark:text-gray-50 font-semibold focus:border-blue-500 focus:outline-none">
            </div>
            <div class="relative w-full max-w-full flex-grow flex-1 text-right">
                <button class="bg-blue-500 dark:bg-gray-100 text-white active:bg-blue-600 dark:text-gray-800 dark:active:text-gray-700 text-xs 
                    font-bold uppercase px-3 py-1 rounded outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150" 
                    type="button" wire:click="usuarioAdd">Nuevo Usuario
                </button>
            </div>
        </div>
        <!-- tabla -->
        <div class="w-full overflow-hidden rounded-lg shadow-xs">
            <div class="w-full overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
                            <th class="px-4 py-3">Foto</th>
                            <th class="px-4 py-3">Nombre</th>
                            <th class="px-4 py-3">Correo</th>
                            <th class="px-4 py-3">Rol</th>
                            <th class="px-4 py-3">Ultima Actividad</th>
                            <th class="px-4 py-3">Tokens Generados</th>
                            <th class="px-4 py-3">Limite de Tokens</th>
                            <th class="px-4 py-3">Token Restantes</th>
                            <th class="px-4 py-3">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800">
                        @foreach ($usuarios as $usuario )
                            <tr class="bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-900 text-gray-700 dark:text-gray-400">
                                <td class="px-4 py-3">                                
                                    <img class="h-10 w-10 rounded-full object-cover" src="{{ $usuario->profile_photo_url }}" alt="{{ $usuario->name }}" />
                                </td>
                                <td class="px-4 py-3">
                                    <a href="{{route('perfiles',$usuario->id)}}">
                                        {{$usuario->name}}
                                    </a>                                    
                                </td>
                                <td class="px-4 py-3">
                                    {{$usuario->email}}
                                </td>
                                <td class="px-4 py-3">
                                    @foreach($usuario->roles as $role)
                                        {{ $role->name }}
                                    @endforeach
                                </td>
                                <td class="px-4 py-3">
                                    {{$usuario->updated_at}}
                                </td>
                                <td class="px-4 py-3">
                                    @if ($usuario->tokens())
                                        {{$usuario->tokens()->count()}}
                                    @else
                                        <p>No Usado</p>
                                    @endif
                                </td>
                                <td class="px-4 py-3">
                                    @if ($usuario->parametro->limite)
                                        {{$usuario->parametro->limite}}
                                    @else
                                        <p>No Usado</p>
                                    @endif                                    
                                </td>
                                <td class="px-4 py-3">
                                    @if ($usuario->parametro->limite)
                                        {{$usuario->parametro->limite - $usuario->tokens()->count()}}
                                    @else
                                        <p>No Usado</p>
                                    @endif
                                </td>
                                <td class="px-4 py-3">
                                    <button class="bg-blue-500 dark:bg-gray-100 text-white active:bg-blue-600 dark:text-gray-800 dark:active:text-gray-700 text-xs 
                                    font-bold uppercase px-3 py-1 rounded outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150" 
                                        type="button" >Editar
                                    </button>                              
                                    <button class="bg-blue-500 dark:bg-red-700 text-white active:bg-blue-600 dark:text-red-200 
                                        dark:active:text-red-100 text-xs font-bold uppercase px-3 py-1 rounded outline-none focus:outline-none mr-1 mb-1 
                                        ease-linear transition-all duration-150" 
                                        type="button" wire:click="consultarBorrarUsuario({{$usuario->id}})" >Eliminar
                                    </button>
                                </td>
                                
                            </tr>                                
                        @endforeach
                    </tbody>                        
                </table>
            </div>
            <div class="grid px-4 py-3 text-xs font-semibold tracking-wide text-base uppercase border-t dark:border-gray-700 bg-gray-50 sm:grid-cols-9
                         dark:text-gray-300 dark:bg-gray-800">
                <span class="flex col-span-4 mt-2 sm:mt-auto sm:justify-end">
                    {{$usuarios->links()}}
                </span>            
            </div>
        </div>
    <!-- \tabla -->
    </div>
    
<!-- Inicio del Modal para Registrar usuario -->
    <x-jet-dialog-modal wire:model="modalAgregarUsuario">
        <x-slot name="title">
            {{ __('Registrar Usuario') }}
        </x-slot>
        <x-slot name="content">             
            <div class="flex flex-col">
                <x-jet-label for="name" class="bg-gray-100 dark:bg-gray-700 dark:text-white" value="{{ __('Nombre') }}" />
                <x-jet-input id="name" type="text" class="w-100 mt-2 py-3 px-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-400 
                dark:border-gray-700 text-gray-800 dark:text-gray-50 font-semibold focus:border-blue-500 focus:outline-none" wire:model.defer="name"/>
                <x-jet-input-error for="name" class="mt-2 bg-gray-100 dark:bg-gray-700 dark:text-white" />                                                     
            </div>
            <div class="flex flex-col mt-2">
                <x-jet-label for="email" class="bg-gray-100 dark:bg-gray-700 dark:text-white" value="{{ __('Correo') }}" />
                <x-jet-input id="email" type="email" class="w-100 mt-2 py-3 px-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-400 
                dark:border-gray-700 text-gray-800 dark:text-gray-50 font-semibold focus:border-blue-500 focus:outline-none" wire:model.defer="email"/>
                <x-jet-input-error for="email" class="mt-2 bg-gray-100 dark:bg-gray-700 dark:text-white" />                                                     
            </div>
            <div class="flex flex-col mt-2">
                <x-jet-label for="rol" class="bg-gray-100 dark:bg-gray-700 dark:text-white" value="{{ __('Rol') }}" />
                <select name="rol" id="rol" wire:model.defer="rol" class="w-100 mt-2 py-3 px-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-400 
                dark:border-gray-700 text-gray-800 dark:text-gray-50 font-semibold focus:border-blue-500 focus:outline-none">
                    <option value="" selected>Seleccionar Rol</option>
                    @foreach ($roles as $role)                            
                        <option value="{{ $role->id }}">{{ $role->name }}</option>                            
                    @endforeach                        
                </select>
            </div>
            <div class="flex flex-col mt-2">
                <x-jet-label for="token" class="bg-gray-100 dark:bg-gray-700 dark:text-white" value="{{ __('Tokens') }}" />
                <x-jet-input id="token" type="text" class="w-100 mt-2 py-3 px-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-400 
                dark:border-gray-700 text-gray-800 dark:text-gray-50 font-semibold focus:border-blue-500 focus:outline-none" wire:model.defer="token"/>
                <x-jet-input-error for="token" class="mt-2 bg-gray-100 dark:bg-gray-700 dark:text-white" />                                                     
            </div>
        </x-slot>
    
        <x-slot name="footer">            
            <x-jet-secondary-button wire:click="$toggle('modalAgregarUsuario', false)" wire:loading.attr="disabled">
                {{ __('Cerrar') }}
            </x-jet-secondary-button>
            <x-jet-danger-button class="ml-3" wire:click="guardarUsuario()" wire:loading.attr="disabled">
                {{ __('Guardar') }}
            </x-jet-danger-button>
        </x-slot>
    </x-jet-dialog-modal>
<!-- Fin del Modal para Registrar usuario -->

<!-- Inicio del Modal para Eliminar Usuario -->
    <x-jet-dialog-modal wire:model="modalBorrarUsuario">
        <x-slot name="title">
            {{ __('Borrar Usuario') }}
        </x-slot>
        <x-slot name="content">             
            {{$mensaje}}
        </x-slot>

        <x-slot name="footer">            
            <x-jet-secondary-button wire:click="$toggle('modalBorrarUsuario', false)" wire:loading.attr="disabled">
                {{ __('Cerrar') }}
            </x-jet-secondary-button>
            <x-jet-danger-button class="ml-3" wire:click="borrarUsuario({{$identificador}})" wire:loading.attr="disabled">
                {{ __('Eliminar') }}
            </x-jet-danger-button>
        </x-slot>
    </x-jet-dialog-modal>
<!-- Fin del Modal para Eliminar Usuario -->

<!-- Inicio del Modal para mensajes alertas-->
<x-jet-dialog-modal wire:model="modalMensaje">
    <x-slot name="title">
        {{ $titulo }}
    </x-slot>
    <x-slot name="content">             
        {{$mensaje}}
    </x-slot>

    <x-slot name="footer">            
        <x-jet-secondary-button wire:click="$toggle('modalMensaje', false)" wire:loading.attr="disabled">
            {{ __('Cerrar') }}
        </x-jet-secondary-button>
    </x-slot>
</x-jet-dialog-modal>
<!-- Fin del Modal para mensajes alertas -->
</div>
